/* Skills for Nursing Staff */

    DROP TABLE NURSE_SURG_SKILL;
    
    CREATE TABLE NURSE_SURG_SKILL (
        EmpNo INTEGER NOT NULL, 
        Skill INTEGER NOT NULL,
        FOREIGN KEY (EmpNo) REFERENCES STAFF(EmpNo)
            ON UPDATE CASCADE
            ON DELETE CASCADE,
        FOREIGN KEY (Skill) REFERENCES SURG_SKILL (Code)
            ON UPDATE CASCADE
            ON DELETE CASCADE
    );

/* Trigger to make sure that a newly added nurse and surgery skill combination is not duplicated */

    CREATE TRIGGER CHECK_NURSE_SURG_SKILL_DUP_INSERT
    BEFORE INSERT ON NURSE_SURG_SKILL
    FOR EACH ROW
    WHEN EXISTS (
        SELECT 1 FROM NURSE_SURG_SKILL WHERE EmpNo = NEW.EmpNo AND Skill = NEW.Skill
    )
        BEGIN
            SELECT RAISE(ABORT, 'The selected Nurse and Skill combination already exists.');
        END;

/* Trigger to make sure that an updated nurse and surgery skill combination is not duplicated */

    CREATE TRIGGER CHECK_NURSE_SURG_SKILL_DUP_UPDATE
    BEFORE UPDATE ON NURSE_SURG_SKILL
    FOR EACH ROW
    WHEN EXISTS (
        SELECT 1 FROM NURSE_SURG_SKILL WHERE EmpNo = NEW.EmpNo AND Skill = NEW.Skill
    )
        BEGIN
            SELECT RAISE(ABORT, 'The selected Nurse and Skill combination already exists.');
        END;

/* Trigger to make sure a newly inserted Nurse Surgery Skill has an EmpType of 'NURS'*/

    CREATE TRIGGER CHECK_NURSE_SURG_SKILL_INSERT
    BEFORE INSERT ON NURSE_SURG_SKILL
    FOR EACH ROW
    WHEN NOT EXISTS (
        SELECT 1 FROM STAFF WHERE EmpNo = NEW.EmpNo AND EmpType = 'NURS'
    )
    BEGIN
        SELECT RAISE (ABORT, 'The selected employee must be a Nurse.');
    END;

/* Trigger to make sure an updated Nurse Surgery Skill has an EmpType of 'NURS'*/

    CREATE TRIGGER CHECK_NURSE_SURG_SKILL_UPDATE
    BEFORE UPDATE ON NURSE_SURG_SKILL
    FOR EACH ROW
    WHEN NOT EXISTS (
        SELECT 1 FROM STAFF WHERE EmpNo = NEW.EmpNo AND EmpType = 'NURS'
    )
    BEGIN
        SELECT RAISE (ABORT, 'The selected employee must be a Nurse.');
    END;