/* Trigger to make sure a newly inserted patient allergy DiagnosedBy has an EmpType of 'PHYS' or Title of 'Chief of Staff' */

DROP TRIGGER CHECK_ALLERGY_DIAGNOSER_INSERT;

CREATE TRIGGER CHECK_ALLERGY_DIAGNOSER_INSERT
BEFORE INSERT ON PATIENT_ALLERGY
FOR EACH ROW
WHEN NOT EXISTS (
    SELECT 1 FROM STAFF WHERE EmpNo = NEW.DiagnosedBy AND (EmpType = 'PHYS' OR Title = 'Chief of Staff')
)
BEGIN
    SELECT RAISE (ABORT, 'The selected Diagnoser must be a Physician or the Chief of Staff.');
END;