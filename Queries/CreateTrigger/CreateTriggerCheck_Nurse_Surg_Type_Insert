/* Trigger to make sure a newly inserted Nurse Surgery Type has an EmpType of 'NURS' and possesses all minimum skills for surgery type */

DROP TRIGGER CHECK_NURSE_SURG_TYPE_INSERT;

CREATE TRIGGER CHECK_NURSE_SURG_TYPE_INSERT
BEFORE INSERT ON NURSE_SURG_TYPE
FOR EACH ROW
WHEN NOT EXISTS (
    SELECT 1 FROM STAFF WHERE EmpNo = NEW.EmpNo AND EmpType = 'NURS'
) OR EXISTS (
    SELECT * FROM SURG_TYPE_SKILL A WHERE A.Type = NEW.Type AND NOT EXISTS (
        SELECT * FROM NURSE_SURG_SKILL B WHERE B.EmpNo = NEW.EmpNo AND B.Skill = A.Skill
    )
)
BEGIN
    SELECT RAISE (ABORT, 'The selected employee must be a Nurse with all appropriate Skills for the selected Surgery Type.');
END;