/* Trigger to make sure a newly inserted Nurse for a Surgery specializes in the appropriate surgery type */

DROP TRIGGER CHECK_SURGERY_NURSE_INSERT;

CREATE TRIGGER CHECK_SURGERY_NURSE_INSERT
BEFORE INSERT ON SURGERY_STAFF
FOR EACH ROW
WHEN EXISTS (
    SELECT 1 FROM STAFF WHERE EmpNo = NEW.EmpNo AND EmpType = 'NURS'
)
AND NOT EXISTS (
    SELECT 1 FROM SURGERY A, NURSE_SURG_TYPE B WHERE A.SurgeryNo = NEW.SurgeryNo AND NEW.EmpNo = B.EmpNo AND A.SurgeryType = B.Type
)
BEGIN
    SELECT RAISE (ABORT, 'The selected Nurse does not possess the appropriate Surgery Type specialization for the selected Surgery.');
END;